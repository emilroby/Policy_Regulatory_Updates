<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSEFI Policy and Regulatory Monitoring Dashboard</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Custom professional shadow for elements */
        .shadow-pro {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
        }
        /* Custom scrollbar styles for the policy list containers */
        .policy-card-container {
            max-height: 400px; 
            overflow-y: auto; 
            padding: 0 4px; 
            margin: 0 -4px;
            scrollbar-width: thin; 
            scrollbar-color: #165843 #f1f1f1;
            scroll-behavior: smooth; 
        }
        .policy-card-container::-webkit-scrollbar { width: 8px; }
        .policy-card-container::-webkit-scrollbar-thumb { background-color: #165843; border-radius: 10px; }
        .policy-card-container::-webkit-webkit-scrollbar-track { background: #e0e0e0; }
        
        /* New style for the real-time clock */
        .real-time-clock {
            font-weight: 600;
            font-size: 0.875rem; /* text-sm */
            color: #4b5563; /* gray-600 */
        }
        
        /* New class for a cleaner, more professional navbar */
        .professional-nav-link {
            padding: 8px 16px;
            text-decoration: none;
            font-weight: 600;
            color: #0F4237; /* Dark green text */
            border-radius: 8px;
            transition: all 0.2s;
            display: block; /* Ensure full clickable area for dropdowns */
        }
        .professional-nav-link:hover {
            background-color: #e6f1ec; /* Very subtle light green background */
            color: #165843; /* Darker green on hover */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        /* --- DROPDOWN STYLES: ADOPTED FROM SLATE FOR RELIABILITY --- */
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            background-color: #f7f7f7; 
            min-width: 220px; 
            border-radius: 0.5rem;
            box-shadow: 0 6px 20px rgba(0, 66, 66, 0.2); 
            border-top: 3px solid #165843;
            margin-top: 0.5rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .group:hover .dropdown-menu {
            display: block;
            opacity: 1;
            visibility: visible;
        }
        .dropdown-link {
            display: block;
            padding: 0.75rem 1.5rem;
            color: #374151;
            font-weight: 500;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            transition: background-color 0.2s, color 0.2s;
        }
        .dropdown-link:last-child {
            border-bottom: none;
        }
        .dropdown-link:hover {
            background-color: #165843; 
            color: white; 
            font-weight: 600;
        }
        /* --- END DROPDOWN STYLES --- */

        /* Enhanced card hover effect */
        .policy-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        /* --- SLATE REFACTOR STYLES --- */
        .fixed-header-nav {
            height: 80px;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            /* Background set to white with slight transparency */
            background: rgba(255, 255, 255, 0.98); 
            backdrop-filter: blur(10px);
        }
        .header-content-wrapper {
            max-width: 1280px; /* equivalent to container mx-auto */
            width: 100%;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        /* Push the main content down to account for the fixed header */
        .main-content-start {
            padding-top: 100px; 
        }
        .branding-title {
            font-size: 1.5rem; /* Matches SLATE logo size */
            font-weight: 800;
            color: #165843;
            line-height: 1;
            white-space: nowrap;
        }
        /* MODIFIED: Combined Title and Clock Layout */
        .title-clock-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
            padding-right: 2rem;
        }
        .datetime-display {
            /* Removed border-left and padding-left */
            font-size: 0.9rem;
            color: #374151;
            font-weight: 500;
            margin-top: 2px; /* Small space below the title */
            line-height: 1.1;
        }
    </style>
</head>
<body>
    <div id="app-root">
        <!-- Dashboard will be rendered here -->
        <div class="min-h-screen bg-white text-[#0F4237] font-sans">
            
            <!-- FIXED NAVIGATION BAR (SLATE STYLE) -->
            <nav class="fixed fixed-header-nav top-0 left-0 right-0">
                <div class="header-content-wrapper flex items-center justify-between h-full">
                    
                    <!-- LEFT ZONE: Combined Title and Real-Time Clock -->
                    <div class="title-clock-container">
                         <!-- Title (Branding) -->
                        <h1 class="branding-title">
                            NSEFI Policy and Regulatory Monitoring Dashboard
                        </h1>
                        <!-- Real-Time Clock -->
                        <div id="real-time-clock" class="datetime-display">
                            Loading Date/Time...
                        </div>
                    </div>

                    <!-- Right Zone: Navigation Links (Buttons) -->
                    <div class="flex items-center space-x-2">
                        <a href="#" class="professional-nav-link">Home</a>
                        <a href="#" class="professional-nav-link">Representations</a>
                        
                        <!-- Policies Dropdown -->
                        <div class="relative group">
                            <span class="professional-nav-link cursor-pointer flex items-center">
                                Policies 
                                <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </span>
                            
                            <div class="dropdown-menu absolute">
                                <a href="#" class="dropdown-link" onclick="openFullDropdown(event, 'Central Policies', CENTRAL_GOVT_SOURCES)">Central</a>
                                <a href="#" class="dropdown-link" onclick="openFullDropdown(event, 'State Policies', ALL_STATES)">States</a>
                                <a href="#" class="dropdown-link" onclick="openFullDropdown(event, 'UT Policies', ALL_UTS)">UTs</a>
                            </div>
                        </div>

                        <!-- Regulations Dropdown -->
                        <div class="relative group">
                            <span class="professional-nav-link cursor-pointer flex items-center">
                                Regulations 
                                <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </span>
                            
                            <div class="dropdown-menu absolute">
                                <a href="#" class="dropdown-link" onclick="openFullDropdown(event, 'Central Regulations', CENTRAL_GOVT_SOURCES)">Central</a>
                                <a href="#" class="dropdown-link" onclick="openFullDropdown(event, 'State Regulations', ALL_STATES)">States</a>
                                <a href="#" class="dropdown-link" onclick="openFullDropdown(event, 'UT Regulations', ALL_UTS)">UTs</a>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- END FIXED NAVIGATION BAR -->


            <!-- MAIN CONTENT AREA - Starts below the fixed header -->
            <main class="main-content-start p-4 sm:p-8">
                <h2 id="month-title" class="text-3xl font-bold mb-8 text-[#165843] border-l-4 border-[#165843] pl-3">Latest updates — Loading Month...</h2>
                
                <!-- Main Three-Column Data Grid -->
                <div id="policy-grid" class="grid gap-8 lg:grid-cols-3 md:grid-cols-2 grid-cols-1">
                    <!-- Columns rendered by JavaScript -->
                </div>
            </main>
        </div>

        <!-- Policy Detail Modal -->
        <div id="policyModal" class="fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50 hidden" onclick="closeModal()">
            <div class="bg-white text-[#0F4237] rounded-xl shadow-2xl max-w-4xl w-full max-h-[95vh] overflow-y-auto transform transition-all duration-300" onclick="event.stopPropagation()">
                <div class="p-6 sm:p-8">
                    <div class="flex justify-between items-start mb-6 border-b border-gray-200 pb-4">
                        <h2 id="modalTitle" class="text-2xl sm:text-3xl font-bold text-[#165843] pr-4"></h2>
                        <button onclick="closeModal()" class="text-gray-500 hover:text-red-600 p-1 rounded-full bg-gray-100">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                    
                    <div id="modalMeta" class="flex flex-wrap items-center text-sm text-gray-600 mb-6 space-x-4"></div>
                    <p id="modalSummary" class="text-gray-700 whitespace-pre-wrap leading-relaxed mb-6"></p>
                    <a id="modalLink" href="#" target="_blank" class="inline-flex items-center px-6 py-2 bg-[#165843] text-white font-bold rounded-lg hover:bg-[#0F4237] transition-colors duration-200 shadow-pro">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        View Original Document
                    </a>
                </div>
            </div>
        </div>

        <!-- Full List Modal for Central/State/UT entities -->
        <div id="fullListModal" class="fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-[3000] hidden" onclick="closeFullDropdown()">
            <div class="bg-white text-[#0F4237] rounded-xl shadow-2xl max-w-xl w-full max-h-[90vh] overflow-y-auto transform transition-all duration-300" onclick="event.stopPropagation()">
                <div class="p-6 sm:p-8">
                    <div class="flex justify-between items-start mb-6 border-b border-gray-200 pb-4">
                        <h2 id="fullListTitle" class="text-2xl sm:text-3xl font-bold text-[#165843] pr-4"></h2>
                        <button onclick="closeFullDropdown()" class="text-gray-500 hover:text-red-600 p-1 rounded-full bg-gray-100">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                    
                    <ul id="fullListContent" class="space-y-2 max-h-96 overflow-y-auto p-2">
                        <!-- List of entities goes here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // --- DATA STRUCTURES & MOCK DATA ---
        // Canonical lists for dropdowns
        const CENTRAL_GOVT_SOURCES = ['MoP', 'MNRE', 'MoF', 'CEA', 'CERC', 'CTUIL', 'Grid India'];
        
        const ALL_STATES = [
            "Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa", "Gujarat", "Haryana",
            "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh", "Maharashtra", "Manipur",
            "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab", "Rajasthan", "Sikkim", "Tamil Nadu",
            "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal"
        ];
        const ALL_UTS = [
            "Andaman and Nicobar Islands", "Chandigarh", "Dadra and Nagar Haveli and Daman and Diu", "Delhi",
            "Jammu and Kashmir", "Ladakh", "Lakshadweep", "Puducherry"
        ];
        
        const STATE_SOURCES_MOCK = ['All States', 'Gujarat', 'Maharashtra', 'Karnataka', 'Tamil Nadu', 'Rajasthan', 'Uttar Pradesh'];
        const UT_SOURCES_MOCK = ['All UTs', 'Delhi', 'Jammu and Kashmir', 'Puducherry'];

        const COLUMNS = [
            { key: 'Central', label: 'Central', filters: CENTRAL_GOVT_SOURCES },
            { key: 'State', label: 'States', filters: STATE_SOURCES_MOCK }, // Using mock subset for column filter
            { key: 'UT', label: 'UTs', filters: UT_SOURCES_MOCK } // Using mock subset for column filter
        ];

        let ALL_POLICIES = [];
        let CURRENT_FILTERS = { Central: 'All', State: 'All', UT: 'All' };
        let SEARCH_QUERY = ''; // Still required if we want to add a search bar later

        function generateMockPolicies() {
            const policies = [];
            const now = new Date();
            const mockTitles = [
                "New Tariff Policy for Solar Power Procurement Guidelines",
                "Details of Transmission Access Charge Waiver on Open Access",
                "CTUIL's Procedure for Inquiry in cases of Alleged Fraud",
                "Additional details as per Regulation 37.10(a) Compliance",
                "Draft Electricity (Metering) Rules, 2025 Consultation Paper",
                "Revised PPA Model for Renewable Energy Projects in Karnataka",
                "Maharashtra EV Policy 2024: Charging Infrastructure Subsidy",
                "Draft Regulation on Grid Connectivity of Renewable Energy Sources (Rajasthan)"
            ];
            const mockSummaries = [
                "Modifies conditions for accessing interstate transmission systems to promote green energy uptake.",
                "Provides clarity on new charges applicable to transmission access for solar and wind projects.",
                "Outlines the official process for investigating alleged fraud or transgressions in license applications.",
                "Specific compliance guidance related to regulatory procedures for major power stakeholders.",
                "Invites public comments and suggestions on proposed changes to electricity metering rules.",
                "Introduces revised contractual terms aimed at increasing viability for private renewable energy developers.",
                "Detailing incentives and financial support for deploying charging stations across the state of Maharashtra.",
                "Specific rules governing the connection of large-scale renewable projects to the regional grid."
            ];
            const mockSources = {
                Central: CENTRAL_GOVT_SOURCES,
                State: ALL_STATES,
                UT: ALL_UTS
            };

            let idCounter = 1;
            for (let i = 0; i < 30; i++) {
                const typeKey = i % 3 === 0 ? 'Central' : (i % 3 === 1 ? 'State' : 'UT');
                const sources = mockSources[typeKey];
                const randomSource = sources[Math.floor(Math.random() * sources.length)];
                const date = new Date(now.getTime() - Math.floor(Math.random() * 60 * 24 * 60 * 60 * 1000));
                
                policies.push({
                    id: `mock-${idCounter++}`,
                    title: mockTitles[idCounter % mockTitles.length],
                    summary: mockSummaries[idCounter % mockSummaries.length],
                    url: 'https://example.com/mock-policy',
                    source: randomSource,
                    source_type: typeKey,
                    publication_date: date,
                    dateString: `${date.getDate().toString().padStart(2, '0')} ${date.toLocaleString('default', { month: 'short' }).toUpperCase()}`
                });
            }
            return policies;
        }

        // --- CORE LOGIC ---

        function updateClock() {
            const clockEl = document.getElementById('real-time-clock');
            if (clockEl) {
                const now = new Date();
                const options = { 
                    timeZone: 'Asia/Kolkata', 
                    day: '2-digit', month: 'short', year: 'numeric', 
                    hour: '2-digit', minute: '2-digit', second: '2-digit', 
                    hour12: false 
                };
                const formatter = new Intl.DateTimeFormat('en-GB', options);
                clockEl.textContent = `${formatter.format(now)} IST`;
            }
        }

        function initApp() {
            ALL_POLICIES = generateMockPolicies();
            updateMonthTitle();
            renderDashboard();
            startAutoScroll(); 
            
            // Start the real-time clock update
            updateClock();
            setInterval(updateClock, 1000); 
        }

        function updateMonthTitle() {
            const monthTitleEl = document.getElementById('month-title');
            const currentMonthYear = new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
            monthTitleEl.textContent = `Latest updates — ${currentMonthYear}`;
        }
        
        function handleSearch(query) {
            SEARCH_QUERY = query.toLowerCase();
            renderDashboard();
        }

        function handleFilterChange(columnKey, value) {
            CURRENT_FILTERS[columnKey] = value;
            renderDashboard();
        }

        function filterAndCategorizePolicies() {
            let searchFiltered = ALL_POLICIES.filter(policy => 
                policy.title.toLowerCase().includes(SEARCH_QUERY) || 
                policy.source.toLowerCase().includes(SEARCH_QUERY) ||
                (policy.summary || '').toLowerCase().includes(SEARCH_QUERY)
            );

            searchFiltered.sort((a, b) => b.publication_date.getTime() - a.publication_date.getTime());

            const categorized = { Central: [], State: [], UT: [] };

            searchFiltered.forEach(policy => {
                const type = policy.source_type;
                const specificFilter = CURRENT_FILTERS[type];
                
                if (categorized[type]) {
                    if (policy.source_type === type) {
                        if (specificFilter === 'All' || specificFilter === 'All States' || specificFilter === 'All UTs' || policy.source === specificFilter) {
                            categorized[type].push(policy);
                        }
                    }
                }
            });

            return categorized;
        }

        // --- RENDERING ---
        
        function renderDashboard() {
            const categorizedPolicies = filterAndCategorizePolicies();
            const gridEl = document.getElementById('policy-grid');
            gridEl.innerHTML = ''; // Clear existing content

            COLUMNS.forEach(column => {
                const columnPolicies = categorizedPolicies[column.key];
                
                const columnHtml = `
                    <div class="flex flex-col rounded-xl shadow-pro border border-gray-200 bg-gray-50 p-4">
                        <div class="mb-4 pb-2 border-b border-gray-300">
                            <h3 class="text-xl font-bold text-[#0F4237]">${column.label}</h3>
                        </div>
                        
                        <div class="mb-4">
                            <select 
                                class="w-full bg-white text-[#0F4237] text-base p-2 rounded-lg border border-gray-300 shadow-sm focus:ring-1 focus:ring-[#165843]"
                                onchange="handleFilterChange('${column.key}', this.value)"
                            >
                                <option value="All">All</option>
                                ${column.filters.filter(f => !f.startsWith('All')).map(source => `
                                    <option value="${source}" ${CURRENT_FILTERS[column.key] === source ? 'selected' : ''}>${source}</option>
                                `).join('')}
                            </select>
                        </div>

                        <div class="flex-grow space-y-4 policy-card-container p-1 -m-1">
                            ${columnPolicies.length === 0 ? 
                                `<div class="text-center text-gray-500 p-8 bg-white rounded-xl shadow-pro">No updates found for ${column.label}.</div>` : 
                                columnPolicies.map(policy => `
                                    <div 
                                        class="policy-card bg-[#F7FBF9] p-4 rounded-xl shadow-sm border border-gray-200 transition-all duration-300 cursor-pointer flex space-x-3"
                                        onclick="openModal(event, '${policy.id}')"
                                    >
                                        <div class="flex-shrink-0 text-center bg-[#0F4237] text-white rounded-lg p-2 w-14 shadow-pro border border-gray-300">
                                            <div class="text-xl font-bold leading-none">${policy.dateString.split(' ')[0]}</div>
                                            <div class="text-xs uppercase leading-tight">${policy.dateString.split(' ')[1]}</div>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-base text-[#0F4237] mb-0.5 line-clamp-3 leading-snug">${policy.title}</h4>
                                            <p class="text-xs text-gray-500 line-clamp-1">${policy.summary || 'Click for details...'}</p>
                                        </div>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;
                gridEl.innerHTML += columnHtml;
            });
        }

        // --- AUTO-SCROLL LOGIC (Floating Updates) ---
        function startAutoScroll() {
            const containers = document.querySelectorAll('.policy-card-container');
            const scrollSpeed = 0.5; // Pixels per frame

            containers.forEach(container => {
                let isPaused = false;

                // Pause scrolling on user interaction
                container.addEventListener('mouseenter', () => isPaused = true);
                container.addEventListener('mouseleave', () => isPaused = false);
                container.addEventListener('wheel', () => isPaused = true); 
                container.addEventListener('touchstart', () => isPaused = true); 

                function scrollTick() {
                    if (!isPaused) {
                        // Check if container has enough content to scroll
                        if (container.scrollHeight > container.clientHeight) {
                             container.scrollTop += scrollSpeed;
                            
                            // If reached the bottom, smoothly reset to top
                            if (container.scrollTop + container.clientHeight >= container.scrollHeight) {
                                // Add a short pause before snapping back, then resume scrolling
                                isPaused = true;
                                setTimeout(() => {
                                    container.scrollTop = 0;
                                    isPaused = false;
                                }, 2000); // 2-second pause at the bottom
                            }
                        }
                    }
                    requestAnimationFrame(scrollTick);
                }
                requestAnimationFrame(scrollTick);
            });
        }


        // --- MODAL LOGIC ---

        function openModal(event, policyId) {
            event.preventDefault();
            const policy = ALL_POLICIES.find(p => p.id === policyId);
            if (!policy) return;

            const modal = document.getElementById('policyModal');
            document.getElementById('modalTitle').textContent = policy.title;
            document.getElementById('modalSummary').textContent = policy.summary;
            document.getElementById('modalLink').href = policy.url;

            const metaHtml = `
                <span class="px-3 py-1 rounded-full text-xs font-medium text-white 
                    ${policy.source_type === 'Central' ? 'bg-[#165843]' : (policy.source_type === 'State' ? 'bg-green-600' : 'bg-blue-600')}"
                >${policy.source_type} (${policy.source})</span>
                <span>Published: ${policy.publication_date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
            `;
            document.getElementById('modalMeta').innerHTML = metaHtml;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeModal() {
            const modal = document.getElementById('policyModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // --- NEW FULL DROPDOWN MODAL LOGIC (Level 3 Resolver) ---

        function openFullDropdown(event, title, entityList) {
            event.preventDefault();
            const modal = document.getElementById('fullListModal');
            document.getElementById('fullListTitle').textContent = title;
            const content = document.getElementById('fullListContent');
            content.innerHTML = '';
            
            // Generate list items
            const listHtml = entityList.map(entity => {
                // Determine the correct policy/regulation type from the title (e.g., 'Central Policies')
                const type = title.includes('Policy') ? 'Policy' : 'Regulation'; 
                // Create a generic link for now; in the final system, this would point to a filtered page/route.
                const href = `?type=${type}&entity=${encodeURIComponent(entity)}`;
                
                return `
                    <li>
                        <a href="${href}" class="dropdown-link text-left hover:text-white hover:bg-[#165843] rounded-md transition-colors duration-200">
                            ${entity}
                        </a>
                    </li>
                `;
            }).join('');

            content.innerHTML = `<ul class="space-y-1">${listHtml}</ul>`;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeFullDropdown() {
            const modal = document.getElementById('fullListModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }


        // --- INITIALIZATION ---
        window.onload = initApp;

    </script>
</body>
</html>
