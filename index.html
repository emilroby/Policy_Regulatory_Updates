<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSEFI Policy and Regulatory Monitoring Dashboard</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Custom scrollbar styles for the policy list containers */
        .policy-card-container {
            max-height: 400px; 
            overflow-y: auto; 
            padding: 0 4px; 
            margin: 0 -4px;
            scrollbar-width: thin; 
            scrollbar-color: #165843 #f1f1f1;
        }
        .policy-card-container::-webkit-scrollbar { width: 8px; }
        .policy-card-container::-webkit-scrollbar-thumb { background-color: #165843; border-radius: 10px; }
        .policy-card-container::-webkit-scrollbar-track { background: #e0e0e0; }
    </style>
</head>
<body>
    <div id="app-root">
        <!-- Dashboard will be rendered here -->
        <div class="min-h-screen bg-white text-[#0F4237] font-sans p-4 sm:p-8">
            <header class="mb-8">
                <div class="flex items-center space-x-4 mb-4 justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="bg-[#165843] p-3 rounded-lg shadow-xl flex-shrink-0">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h1 class="text-xl sm:text-3xl font-extrabold text-[#0F4237] leading-tight">
                            NSEFI Policy and Regulatory Monitoring Dashboard
                        </h1>
                    </div>
                    <div id="last-updated" class="text-xs sm:text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full shadow-md border border-gray-200 flex-shrink-0">
                        Last updated: <span>Loading...</span>
                    </div>
                </div>

                <nav class="bg-[#165843] rounded-xl shadow-2xl p-2 flex space-x-4 overflow-x-auto mb-6">
                    <a href="#" class="px-3 py-2 text-sm font-semibold text-white hover:bg-[#0F4237] rounded-lg transition-colors duration-200 whitespace-nowrap">Home</a>
                    <a href="#" class="px-3 py-2 text-sm font-semibold text-white hover:bg-[#0F4237] rounded-lg transition-colors duration-200 whitespace-nowrap">Representations</a>
                    <a href="#" class="px-3 py-2 text-sm font-semibold text-white hover:bg-[#0F4237] rounded-lg transition-colors duration-200 whitespace-nowrap">Policies</a>
                    <a href="#" class="px-3 py-2 text-sm font-semibold text-white hover:bg-[#0F4237] rounded-lg transition-colors duration-200 whitespace-nowrap">Regulations</a>
                </nav>
            </header>

            <h2 id="month-title" class="text-2xl font-semibold mb-4 text-[#0F4237]">Latest updates — Loading Month...</h2>
            <div class="mb-8 p-4 bg-gray-50 rounded-xl shadow-inner border border-gray-200 relative">
                <svg class="w-5 h-5 text-gray-500 absolute left-8 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <input type="text" id="searchInput" class="w-full bg-white border border-gray-300 text-[#0F4237] rounded-lg py-3 pl-14 pr-4 focus:outline-none focus:ring-2 focus:ring-[#165843]" placeholder="Search policies by title or source..." oninput="handleSearch(this.value)">
            </div>

            <!-- Main Three-Column Data Grid -->
            <div id="policy-grid" class="grid gap-6 lg:grid-cols-3 md:grid-cols-2 grid-cols-1">
                <!-- Columns rendered by JavaScript -->
            </div>
        </div>

        <!-- Policy Detail Modal -->
        <div id="policyModal" class="fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50 hidden" onclick="closeModal()">
            <div class="bg-white text-[#0F4237] rounded-xl shadow-2xl max-w-4xl w-full max-h-[95vh] overflow-y-auto transform transition-all duration-300" onclick="event.stopPropagation()">
                <div class="p-6 sm:p-8">
                    <div class="flex justify-between items-start mb-6 border-b border-gray-200 pb-4">
                        <h2 id="modalTitle" class="text-2xl sm:text-3xl font-bold text-[#165843] pr-4"></h2>
                        <button onclick="closeModal()" class="text-gray-500 hover:text-red-600 p-1 rounded-full bg-gray-100">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                    
                    <div id="modalMeta" class="flex flex-wrap items-center text-sm text-gray-600 mb-6 space-x-4"></div>
                    <p id="modalSummary" class="text-gray-700 whitespace-pre-wrap leading-relaxed mb-6"></p>
                    <a id="modalLink" href="#" target="_blank" class="inline-flex items-center px-6 py-2 bg-[#165843] text-white font-bold rounded-lg hover:bg-[#0F4237] transition-colors duration-200 shadow-md">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        View Original Document
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // --- DATA STRUCTURES & MOCK DATA ---
        const CENTRAL_GOVT_SOURCES = ['MoP', 'MNRE', 'MoF', 'CEA', 'CTUIL', 'CERC', 'Grid India'];
        const STATE_SOURCES = ['All States', 'Gujarat', 'Maharashtra', 'Karnataka', 'Tamil Nadu', 'Rajasthan', 'Uttar Pradesh'];
        const UT_SOURCES = ['All UTs', 'Delhi', 'Jammu and Kashmir', 'Puducherry'];
        
        const COLUMNS = [
            { key: 'Central', label: 'Central', filters: CENTRAL_GOVT_SOURCES },
            { key: 'State', label: 'States', filters: STATE_SOURCES },
            { key: 'UT', label: 'UTs', filters: UT_SOURCES }
        ];

        let ALL_POLICIES = [];
        let CURRENT_FILTERS = { Central: 'All', State: 'All', UT: 'All' };
        let SEARCH_QUERY = '';

        function generateMockPolicies() {
            const policies = [];
            const now = new Date();
            const mockTitles = [
                "New Tariff Policy for Solar Power Procurement Guidelines",
                "Details of Transmission Access Charge Waiver on Open Access",
                "CTUIL's Procedure for Inquiry in cases of Alleged Fraud",
                "Additional details as per Regulation 37.10(a) Compliance",
                "Draft Electricity (Metering) Rules, 2025 Consultation Paper",
                "Revised PPA Model for Renewable Energy Projects in Karnataka",
                "Maharashtra EV Policy 2024: Charging Infrastructure Subsidy",
                "Draft Regulation on Grid Connectivity of Renewable Energy Sources (Rajasthan)"
            ];
            const mockSummaries = [
                "Modifies conditions for accessing interstate transmission systems to promote green energy uptake.",
                "Provides clarity on new charges applicable to transmission access for solar and wind projects.",
                "Outlines the official process for investigating alleged fraud or transgressions in license applications.",
                "Specific compliance guidance related to regulatory procedures for major power stakeholders.",
                "Invites public comments and suggestions on proposed changes to electricity metering rules.",
                "Introduces revised contractual terms aimed at increasing viability for private renewable energy developers.",
                "Detailing incentives and financial support for deploying charging stations across the state of Maharashtra.",
                "Specific rules governing the connection of large-scale renewable projects to the regional grid."
            ];
            const mockSources = {
                Central: ['MoP', 'CERC', 'MNRE'],
                State: ['Gujarat', 'Maharashtra', 'Karnataka', 'Tamil Nadu'],
                UT: ['Delhi', 'Puducherry']
            };

            let idCounter = 1;
            for (let i = 0; i < 30; i++) {
                const typeKey = i % 3 === 0 ? 'Central' : (i % 3 === 1 ? 'State' : 'UT');
                const sources = mockSources[typeKey];
                const randomSource = sources[Math.floor(Math.random() * sources.length)];
                const date = new Date(now.getTime() - Math.floor(Math.random() * 60 * 24 * 60 * 60 * 1000));
                
                policies.push({
                    id: `mock-${idCounter++}`,
                    title: mockTitles[idCounter % mockTitles.length],
                    summary: mockSummaries[idCounter % mockSummaries.length],
                    url: 'https://example.com/mock-policy',
                    source: randomSource,
                    source_type: typeKey,
                    publication_date: date,
                    dateString: `${date.getDate().toString().padStart(2, '0')} ${date.toLocaleString('default', { month: 'short' }).toUpperCase()}`
                });
            }
            return policies;
        }

        // --- CORE LOGIC ---

        function initApp() {
            ALL_POLICIES = generateMockPolicies();
            updateMonthTitle();
            updateLastUpdated();
            renderDashboard();
        }

        function updateMonthTitle() {
            const monthTitleEl = document.getElementById('month-title');
            const currentMonthYear = new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
            monthTitleEl.textContent = `Latest updates — ${currentMonthYear}`;
        }

        function updateLastUpdated() {
            const lastUpdatedEl = document.getElementById('last-updated');
            const time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            lastUpdatedEl.innerHTML = `Last updated: <span>${time}</span>`;
        }
        
        function handleSearch(query) {
            SEARCH_QUERY = query.toLowerCase();
            renderDashboard();
        }

        function handleFilterChange(columnKey, value) {
            CURRENT_FILTERS[columnKey] = value;
            renderDashboard();
        }

        function filterAndCategorizePolicies() {
            let searchFiltered = ALL_POLICIES.filter(policy => 
                policy.title.toLowerCase().includes(SEARCH_QUERY) || 
                policy.source.toLowerCase().includes(SEARCH_QUERY) ||
                (policy.summary || '').toLowerCase().includes(SEARCH_QUERY)
            );

            searchFiltered.sort((a, b) => b.publication_date.getTime() - a.publication_date.getTime());

            const categorized = { Central: [], State: [], UT: [] };

            searchFiltered.forEach(policy => {
                const type = policy.source_type;
                const specificFilter = CURRENT_FILTERS[type];
                
                if (categorized[type]) {
                    if (specificFilter === 'All' || specificFilter === 'All States' || specificFilter === 'All UTs' || policy.source === specificFilter) {
                        categorized[type].push(policy);
                    }
                }
            });

            return categorized;
        }

        // --- RENDERING ---
        
        function renderDashboard() {
            const categorizedPolicies = filterAndCategorizePolicies();
            const gridEl = document.getElementById('policy-grid');
            gridEl.innerHTML = ''; // Clear existing content

            COLUMNS.forEach(column => {
                const columnPolicies = categorizedPolicies[column.key];
                
                const columnHtml = `
                    <div class="flex flex-col rounded-xl shadow-lg border border-gray-200 bg-gray-50 p-4">
                        <div class="mb-4 pb-2 border-b border-gray-300">
                            <h3 class="text-xl font-bold text-[#0F4237]">${column.label}</h3>
                        </div>
                        
                        <div class="mb-4">
                            <select 
                                class="w-full bg-white text-[#0F4237] text-base p-2 rounded-lg border border-gray-300 shadow-sm focus:ring-1 focus:ring-[#165843]"
                                onchange="handleFilterChange('${column.key}', this.value)"
                            >
                                <option value="All">All</option>
                                ${column.filters.filter(f => !f.startsWith('All')).map(source => `
                                    <option value="${source}" ${CURRENT_FILTERS[column.key] === source ? 'selected' : ''}>${source}</option>
                                `).join('')}
                            </select>
                        </div>

                        <div class="flex-grow space-y-4 policy-card-container p-1 -m-1">
                            ${columnPolicies.length === 0 ? 
                                `<div class="text-center text-gray-500 p-8 bg-white rounded-xl shadow-md">No updates found for ${column.label}.</div>` : 
                                columnPolicies.map(policy => `
                                    <div 
                                        class="bg-[#F7FBF9] p-4 rounded-xl shadow-md border border-gray-200 hover:shadow-xl hover:border-[#165843] transition-all duration-300 cursor-pointer flex space-x-3"
                                        onclick="openModal(event, '${policy.id}')"
                                    >
                                        <div class="flex-shrink-0 text-center bg-[#0F4237] text-white rounded-lg p-2 w-14 shadow-inner border border-[#165843]">
                                            <div class="text-xl font-bold leading-none">${policy.dateString.split(' ')[0]}</div>
                                            <div class="text-xs uppercase leading-tight">${policy.dateString.split(' ')[1]}</div>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-base text-[#0F4237] mb-0.5 line-clamp-3 leading-snug">${policy.title}</h4>
                                            <p class="text-xs text-gray-500 line-clamp-1">${policy.summary || 'Click for details...'}</p>
                                        </div>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;
                gridEl.innerHTML += columnHtml;
            });
        }

        // --- MODAL LOGIC ---

        function openModal(event, policyId) {
            event.preventDefault();
            const policy = ALL_POLICIES.find(p => p.id === policyId);
            if (!policy) return;

            const modal = document.getElementById('policyModal');
            document.getElementById('modalTitle').textContent = policy.title;
            document.getElementById('modalSummary').textContent = policy.summary;
            document.getElementById('modalLink').href = policy.url;

            const metaHtml = `
                <span class="px-3 py-1 rounded-full text-xs font-medium text-white 
                    ${policy.source_type === 'Central' ? 'bg-[#165843]' : (policy.source_type === 'State' ? 'bg-green-600' : 'bg-blue-600')}"
                >${policy.source_type} (${policy.source})</span>
                <span>Published: ${policy.publication_date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
            `;
            document.getElementById('modalMeta').innerHTML = metaHtml;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeModal() {
            const modal = document.getElementById('policyModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }


        // --- INITIALIZATION ---
        window.onload = initApp;

    </script>
</body>
</html>
